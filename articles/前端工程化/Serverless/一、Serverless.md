# 一、Serverless

[[_TOC_]]

## 1. Serverless 的兴起

Serverless 的兴起史就是`云计算的发展史`，即物理机时代、虚拟机时代、容器时代、Serverless 时代

### (1) 物理机时代

#### ① 物理机时代的发展历程

![物理机时代的发展历程]()

#### ② 物理机时代的网站部署架构

物理机时代如果想开发上线一个电商网站，需要以下步骤

* 购买一台服务器（物理机）
* 找个机房给服务器通电并连上网线
* 在服务器上安装操作系统
* 在服务器上安装数据库和网站环境
* 部署网站
* 测试

此时网站架构属于`单机版的单体架构`，数据库、应用、Nginx 等服务全都部署在一台自己管理的服务器上

![物理机时代的网站部署架构]()

物理机时代网站上线和稳定运行面临的最大问题就是`服务器等硬件问题`

* 服务器的购买、场地、电力、网络等开销
* 负责服务器的维护
* 停电导致网络中断，服务器也会随之停机，网站就无法访问了
* 服务器的 CPU 烧毁后，数据如何迁移、新旧环境如何保持一致、如何保证网站持续可用等等问题

由此诞生了虚拟机技术，让开发者无需关注`底层硬件`

### (2) 虚拟机时代

#### ① 虚拟机时代的发展历程

通过虚拟化技术，将一台物理机分割成多台虚拟机提供给多用户使用，充分利用硬件资源，对于开发者来说，直接在云平台购买虚拟机，比起购买服务器成本更低

* **基础设施即服务 LaaS**：云厂商卖的硬件等基础设施
* **平台即服务 PaaS**：云厂商卖的中间件、数据库平台

![虚拟机时代的发展历程]()

#### ② 虚拟机时代的网站部署架构

有了虚拟机技术之后就可以将电商网站迁移到云厂商提供的虚拟机上，再也不用担心断电断网和硬件故障，解决了物理机时代网站上线和稳定运行面临的最大问题（服务器等硬件问题）

为了降低服务器负载，还可以将数据库迁移到云厂商提供的云数据库，云数据库有专门的服务器，还提供了`备份容灾`，比在自己的服务器上安装数据库更稳定性能更强

这样一来，服务器就只负责处理用户请求，将计算和存储分离开，既降低了系统负载，也提升了数据安全性，并且单机应用升级成了`集群应用`，通过`负载均衡`将用户流量均匀分配到每台服务器上

![虚拟机时代的网站部署架构]()

虚拟机时代网站上线和稳定运行面临的最大问题就是`运行环境问题`

* 在服务器扩容过程中，例如购买服务器时很可能之前的型号没有了，只有新的型号，并且每次扩容一台服务器，都需要在新服务器上初始化软件环境和配置，需要保证所有服务器运行环境一致，这是个非常复杂还容易出错的工作
* 总的来说，虚拟机时代可以让开发者无需关注`底层硬件`，但还是需要关注`运行环境`

由此诞生了容器技术，让开发者无需关注`运行环境`

### (3) 容器时代

#### ① 容器时代的发展历程

2013 年 Docker 的发布，代表容器技术替代了虚拟化技术，云计算进入了容器时代

容器就是将应用程序代码和运行环境打包到一起，这样代码就可以在任何地方运行，容器技术让开发者无需关注`运行环境`，容器技术产生之后，开发者在服务器上部署的就不再是应用，而是`容器`，当容器多了之后，诞生了`容器编排技术 Kubernetes`来管理多个容器

开发者不仅使用容器，还需要使用 Kubernetes 管理容器集群，基于 Kubernetes 和云厂商提供的弹性能力，可以实现`网站的自动弹性伸缩`，当流量洪峰到来时，自动弹出更多资源，当流量低谷时，自动释放多余资源

![容器时代的发展历程]()

#### ② 容器时代的网站部署架构

容器时代部署网站的方式如下

* 搭建 Kubernetes 集群
* 构建容器镜像
* 部署镜像

![容器时代的网站部署架构]()

虚拟机时代网站上线和稳定运行面临的最大问题就是`运维问题`

* 使用容器技术，开发者需要规划节点和 Pod 的 CPU、内存、磁盘等资源，需要编写复杂的 YAML 去部署 Pod 和服务，需要经常排查 Pod 出现的异常，这需要专业的运维知识，于是渐渐从开发工程师变成了 `Kubernetes 运维工程师`
* 瞬时流量远超预期时，例如电商网站面临双十一零点订单，集群虽然感知到了需要弹出更多的资源，但服务器弹出需要一定时间，没来得及应对这种瞬时流量，由于`不支持秒级弹性`导致网站崩溃

由此诞生了 Serverless 技术，让开发者无需关注`运维`，只专注于`产品开发`

### (4) Serverless 时代

#### ① Serverless 时代的发展历程

Serverless 翻译成中文就是`无服务器`的意思，无服务器的意思是开发者无需考虑服务器环境搭建和维护等问题，只需专注于开发，Serverless 是一种`软件部署方式`

传统的应用程序需要部署在服务器或虚拟机上，安装运行环境之后以`进程`的方式启动，Serverless 直接使用云厂商提供的运行环境，由云厂商管理、由事件触发、以无状态的方式运行在`容器`内

Serverless 是一个`尚处于发展阶段`的技术，现阶段的实现主要是基于 BaaS、FaaS 的方案

* **后端即服务 BaaS**：将后端能力封装成了服务，并以接口的形式提供，例如数据库、文件存储等
* **函数即服务 FaaS**：提供运行函数代码的能力，并具有`自动弹性伸缩`，基于 FaaS 我们的应用组成就不再是集众多功能于一身的集合体，而是`一个个独立的函数`，每个函数实现各自的业务逻辑，并且能够通过 BaaS 调用各种后端接口，进而以更低开发成本实现复杂的业务逻辑

![Serverless 时代的发展历程]()

#### ② Serverless 时代的网站部署架构

我们通过网关承接用户流量，并将流量转发到 FaaS 平台运行的函数中，每个函数都是一个特定的接口，实现单一业务逻辑，并且基于 BaaS 实现复杂业务功能，函数本身也可以调用其他微服务

总的来说，基于 Serverless 开发者就只需关注`业务逻辑`的开发，应用部署时无需关注`服务器、环境环境、运维`，应用也天然具备`秒级弹性`的自动弹性伸缩，并且实现了按需使用，按量付费，能够进一步节约成本

![Serverless 时代的网站部署架构]()

## 2. Serverless 的定义

### (1) 广义的 Serverless

广义的 Serverless 是指应用程序构建和运行时`无需关注服务器的一种架构思想`

* Serverless 翻译成中文就是`无服务器`的意思，无服务器的意思是开发者无需考虑服务器环境搭建和维护等问题，只需专注于开发，Serverless 是一种`软件部署方式`
* 传统的应用程序需要部署在服务器或虚拟机上，安装运行环境之后以`进程`的方式启动，Serverless 直接使用云厂商提供的运行环境，由云厂商管理、由事件触发、以无状态的方式运行在`容器`内

### (2) 狭义的 Serverless

狭义的 Serverless 是指现阶段 Serverless 主流的技术实现，即 `BaaS 和 FaaS 的组合`，之所以说是狭义的，是因为 Serverless 架构正在持续发展中，未来可能会有更好的技术方案

## 3. Serverless 的特点

### (1) 优点

* **免维护**：开发者无需关注服务器、运行环境、运维，只需专注于业务逻辑开发
* **秒级弹性**：Serverless 让应用天然支持秒级弹性的自动弹性伸缩
* **费用**：Serverless 实现了按需使用、按量付费，进一步节约成本

### (2) 缺点

* **深度绑定**：使用某个云厂商的 Serverless 时，一般会包括多种产品例如函数计算、对象存储、数据库等等，这些产品和云厂商深度绑定，因为现在 Serverless 还`没有一个统一的标准`，各个云厂商实现的 Serverless 产品都不一样，因此如果需要进行项目迁移，成本相对于部署在服务器上会增加很多
* **函数冷启动**：Serverless 应用函数运行前需要`初始化函数执行环境`，这个过程需要耗费一定时间，因为函数不是持续在线的，而是运行时才启动，在延迟敏感的业务场景下需要优化
* **函数通信效率低**：传统的 MVC 架构模式中 View 层方法调用 Model 层方法都是在`内存调用`的，而 Serverless 应用中函数之间完全独立，如果两个函数的数据有依赖，需要进行通信、交换数据，就要进行函数之间的 `HTTP 调用`，HTTP 调用相比内存调用数据交互效率低了很多，这个问题的`本质是 FaaS 还没有较好的数据通信方案或协议`
* **开发调试复杂**：Serverless 架构正处于飞速发展的阶段，其开发、调试、部署工具链并不完善，另外应用依赖的第三方云服务也很难进行调试，想要在本地开发调试 Serverless 应用还是比较复杂
