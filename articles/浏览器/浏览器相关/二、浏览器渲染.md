# 二、浏览器渲染

## 1\. 加载 JS 脚本

### \(2\) 浏览器加载

**① JS脚本**

JS 脚本可能改变脚本间的依赖关系，也可能改变页面，因此必须保证顺序执行 JS 脚本

浏览器遇到 <body\> 标签前不会渲染页面，通常建议将 JS 脚本放在 <body\> 标签后，

内嵌脚本：内嵌脚本无需下载，可以直接执行

外部脚本：外部脚本需要下载后再执行

```javascript
//内嵌脚本
<script>
  //...
</script>

//外部脚本
<script src="./example.js"></script>
```
**② 同步加载脚本**

默认情况下，浏览器同步加载 JS 脚本，即渲染引擎遇到 <script\> 标签就停下来，

1. 如果是内嵌脚本，直接执行，
1. 如果是外部脚本，先下载再执行，

执行完毕后再继续向下渲染，如果脚本体积很大，时间就会很长，容易造成浏览器堵塞

**③ 异步加载外部脚本**

<script\> 标签打开 defer 或者 async 属性，脚本就会异步加载，渲染引擎遇到 <script\> 标签的外部脚本，就会开始下载脚本，但是不会等待，而是继续向下渲染

1. defer 要等到整个页面在内存中正常渲染结束，即 DOM 结构完全生成，并且其他脚本执行完成，此时才会执行当前外部脚本，如果有多个 defer 外部脚本，按照在页面中出现的顺序执行
1. async 是当前外部脚本下载完就开始执行，因此如果有多个 async 外部脚本，不能保证执行顺序

**④ ES6模块加载**

1. 浏览器加载 ES6 模块，也使用 <script\> 标签，但是要加入 `type="module"` 属性，浏览器对于 type="module" 的 <script\> 都是`异步加载`，等同于使用了 <script\> 标签的 `defer` 属性，不会造成浏览器堵塞，
1. 也可以给 ES6 模块的脚本添加 async 属性，浏览器就会使用 async 属性的加载方式

```javascript
//main.js
<script type="module" src="./person.js"></script>

//main.js
<script type="module" src="./person.js" async></script>
```
dd

## 2 重流、重绘

dd

```javascript
//重绘代价高
function doubleHeight(elem) {
  var currentHeight = elem.clientHeight;
  elem.style.height = (currentHeight * 2) + 'px';
}

//重绘代价低
function doubleHeight(elem) {
  var currentHeight = elem.clientHeight;
  //推迟到浏览器下次重流时进行
  window.requestAnimationFrame(function(){ 
    elem.style.height = (currentHeight * 2) + 'px';
  });
}
elems.forEach(doubleHeight);
```
dd
































