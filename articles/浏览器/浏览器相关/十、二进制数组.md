# 十、二进制数组

[[_TOC_]]

## 1. ArrayBuffer对象

### (1) 二进制数组

#### ① 诞生原因

WebGL 是浏览器与显卡间的通信接口，为了满足 JS 与显卡间大量实时的数据交换，两者之间的数据通信必须是`二进制`的，而不能是传统的`文本格式`，因此诞生了 JS 操作二进制数据的各种接口

文本格式：传递一个 `32 位整数`，JS 脚本与显卡都要进行数据转换，非常耗时，

二进制数据：直接操作字节，将 4 个字节的 32 位整数，以二进制的形式原封不动地送入显卡，JS 脚本的性能将大幅度提升

#### ② 操作接口

ArrayBuffer 对象、视图、视图是 JS 操作二进制数据的接口，这些接口早就存在，属于独立的规格，ES6 将其纳入 ES 的规格，

#### ③ 二进制数组

二进制数组是一个`类数组对象`，允许开发者以`数组下标`的形式，直接操作内存处理二进制数据，因此统称为二进制数组，大大增强了 JS 处理二进制数据的能力，使得开发者有可能通过 JS 与操作系统的原生接口进行二进制通信

#### ④ 视图

同一段内存，可以存放`多种类型`的数据，不同数据有不同的解读方法，这就叫做视图

视图的作用是以`指定格式`解读二进制数据，视图部署了数组接口，这意味着能够以数组的方式操作内存

### (2) ArrayBuffer对象

ArrayBuffer 对象代表`存储二进制数据的一段连续内存`，不能直接读写，只能通过`视图`读写，

#### ① 构造函数

ArrayBuffer 构造函数用来分配一段连续的内存区域，参数即为所需要的内存大小（单位字节），

```javascript
定义：const buf = new ArrayBuffer(n);
属性：buf.byteLength            //返回buf的字节长度
方法：buf.slice(n1,n2)          //返回新ArrayBuffer实例,拷贝buf的一部分生成一个新的ArrayBuffer实例
     ArrayBuffer.isView(param) //返回布尔值,param是否为视图
```

检查分配是否成功：

如果分配的内存区域很大，有可能分配失败，通过 byteLength 属性检查是否分配成功

```javascript
const buf = new ArrayBuffer(100);
if(buf.byteLength === 100){
  console.log('分配成功');
} else{
  console.log('分配失败');
}
```

## 2. TypedArray视图

### (1) 构造函数

#### ① 构造函数类型

TypedArray 视图包括 9 种类型，每种视图都是一种构造函数，用来读写`简单类型`的二进制数据，

```javascript
数据类型   字节长度       含义                   对应的C语言类型
Int8        1       8位带符号整数               signed char
Uint8       1       8位无符号整数               unsigned char 
Uint8C      1       8位无符号整数(自动过滤溢出)   unsigned char
Int16       2       16位带符号整数              short
Uint16      2       16位无符号整数              unsigned short
Int32       4       32位带符号整数              int
Uint32      4       32位无符号整数              unsigned int
Float32     4       32位浮点数                 float
Float64     8       64位浮点数                 double
```

#### ② 构造函数参数

第二个参数是视图开始的字节序号，必须与所建立的数据类型一致，否则会报错（可选）

第三个参数是视图包含的数据个数（可选）

第一个参数（必需）：

ArrayBuffer 实例，

`普通数组`，普通数组则直接分配内存生成底层的 ArrayBuffer 实例，同时完成对这段内存的赋值

长度

TypedArray 实例

类数组对象

```javascript
定义：const typedArray = new Int8Array(buffer,n,len);
属性：普通数组所有属性
方法：普通数组除concat外所有方法
```

dd

```javascript


```
dd

### (2) 应用

dd

```javascript
//情况1
const buf = new ArrayBuffer(3);
const x1 = new Int32Array(buf); //

//情况2
const x2 = new Int32Array([0, 1, 2]); //
```

合并多个 TypedArray 数组

针对同一个内存的不同视图，相互影响，一个视图修改底层内存，其他视图也会跟着改变

### (2) 与普通数组差异

① TypedArray 数组所有成员，都是同一类型，

② TypedArray 数组成员是连续的，不会有空位，

③ TypedArray 数组成员默认值为 0，

④ TypedArray 数组只是一层视图，本身并不存储数据，数据都存储在底层的 ArrayBuffer 对象，

## 3. DataView视图

### (1) 构造函数

DataView 视图可以自定义复合格式的视图，用来读写复杂类型的数据，可以从`任意字节`开始解读 ArrayBuffer 对象

```javascript
定义：const dataView = new DataView(buffer);
属性：普通数组的所有属性
方法：普通数组的所有方法
```

### (2) 应用

dd

## 4. 二进制数组的应用

dd

## 5. SharedArrayBuffer

dd

## 6\. Atomics对象

dd
