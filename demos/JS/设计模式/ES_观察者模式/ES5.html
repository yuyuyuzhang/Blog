<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>data bind</title>
</head>
<body>

<button id="btn">点击+1</button>
<span id="show">1</span>

<script>
//数据绑定：关键在于监控数据的变化,可以通过属性描述对象的存取元属性监控对象属性值的改变
//当JS程序查询对象存取器属性的值时,JS调用其属性描述对象的get方法，返回属性存取表达式的值
//当JS程序设置对象存取器属性的值时,JS调用其属性描述对象的set方法，将赋值表达式右侧的值当做参数传入set

//情况1
var obj = {}, value = null;
Object.defineProperty(obj, "num", {
  get: function(){
    console.log('执行了get操作');
    return value;
  },
  set: function(newValue){
    console.log('执行了set操作');
    value = newValue;
  }
});
obj.num = 1           //执行了set操作
console.log(obj.num); //执行了get操作, 1


//情况2：对数据的改变进行存档
function Archiver(){
  var value = null;
  var archive = []; //档案
  Object.defineProperty(this, 'num', {
    get: function(){
      console.log('执行了get操作');
      return value;
    },
    set: function(newValue){
      console.log('执行了set操作');
      value = newValue;
      archive.push({value: newValue});
    }
  });
  this.getArchive = function(){ 
  	return archive; 
  };
}
var arc = new Archiver();
console.log(arc.num);          //执行了get操作
arc.num = 11;                  //执行了set操作
arc.num = 13;                  //执行了set操作
console.log(arc.getArchive()); //[{val: 11}, {val: 13}]


//情况3：数组改变时,自动渲染
//传统写法
var btn = document.getElementById('btn');
var show = document.getElementById('show');
btn.addEventListener('click', function(e){
  show.innerHTML = Number(show.innerHTML) + 1;
});
//使用元编程
var btn = document.getElementById('btn');
var show = document.getElementById('show');
var obj = {value: 1};
Object.defineProperty(obj, 'value', {
  get: function(){
  	return value;
  },
  set: function(newValue){
  	value = newValue;
  	show.innerHTML = newValue;
  }
});
btn.addEventListener('click', function(e){
  obj.value += 1;
});


//情况4：
var btn = document.getElementById('btn');
var show = document.getElementById('show');
var obj = {value: 1};
(function(){
  function watch(obj, prop, f){
    var value = obj[prop];
    Object.defineProperty(obj, prop, {
      get: function(){
        return value;
      },
      set: function(newValue){
        value = newValue;
        f(newValue);
      }
    });
    if(value){
      obj[prop] = value;
    }
  }
  this.watch = watch;
})();
watch(obj, 'value', function(newValue){
  show.innerHTML = newValue;
});
btn.addEventListener('click', function(e){
  obj.value += 1;
});

</script>
</body>
</html>