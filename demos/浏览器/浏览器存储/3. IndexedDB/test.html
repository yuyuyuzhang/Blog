<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IndexedDB</title>
</head>
<body>




<script>

const dbRequest = window.indexedDB.open('demo', 1)
dbRequest.addEventListener('upgradeneeded', function(e){
  console.log('当前数据库版本为：' + dbRequest.result.version)
})
dbRequest.addEventListener('success', function(e){
  console.log('数据库连接成功')
  if(dbRequest.readyState === 'done'){
    //获取连接的数据库
    const db = dbRequest.result
    console.log(db)

    //新建对象仓库
    if(!db.objectStoreNames.contains('person')){
      const personStore = db.createObjectStore('person', {keyPath: 'name'})

      //新建索引
      personStore.createIndex('name', 'name', {unique: true}) //值唯一
      personStore.createIndex('phone', 'phone', {unique: false})
      personStore.createIndex('email', 'email', {unique: false})
      personStore.createIndex('remarks', 'remarks', {unique: false})

      //创建事务
      const transaction = db.transaction(['person'], 'readwrite')
      const currStore = transaction.objectStore('person')

      const addRequest = db.transaction(['person'], 'readwrite')
        .objectStore('person')
        .add({name: '张三', phone: 123, email: 123, remarks: 'aaa'}, '张三')

      addRequest.addEventListener('success', function(e){
        console.log('数据导入成功')
      })
      addRequest.addEventListener('error', function(e){
        console.log('数据导入失败')
      })
    }
  }
})
dbRequest.addEventListener('error', function(e){
  console.log('数据库连接失败')
})
dbRequest.addEventListener('blocked', function(e){
  console.log('数据库连接被锁定，上次的连接还未关闭')
})

</script>
</body>
</html>